<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Trading Journal</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e40af 50%, #0f172a 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ========================================
        // CONFIGURATION - YOUR SETTINGS
        // ========================================
        const CONFIG = {
            BOT_TOKEN: '8489930334:AAFpZpASPCcR6mEQhar72-9Nb3pYZJwOqXE',
            CHAT_ID: '5330125827',
            SHEETS_API_URL: 'https://script.google.com/macros/s/AKfycbwfWVe88DzdDXNr2tTJGv_j3TiC_G6YAZQASVXKDhR_bXCMsL00YSBBUMKBnIgnII5n/exec'
        };

        // Main App Component
        function TradingJournal() {
            const [trades, setTrades] = useState([]);
            const [activeTab, setActiveTab] = useState('entry');
            const [selectedTrade, setSelectedTrade] = useState(null);

            useEffect(() => {
                loadTrades();
            }, []);

            const loadTrades = () => {
                const saved = localStorage.getItem('pro-trades');
                if (saved) {
                    setTrades(JSON.parse(saved));
                }
            };

            const saveTrades = (newTrades) => {
                setTrades(newTrades);
                localStorage.setItem('pro-trades', JSON.stringify(newTrades));
            };

            const sendTelegram = async (message) => {
                try {
                    await fetch(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: CONFIG.CHAT_ID,
                            text: message,
                            parse_mode: 'HTML'
                        })
                    });
                    return true;
                } catch (error) {
                    console.error('Telegram error:', error);
                    return false;
                }
            };

            const saveToSheets = async (trade, action = 'addTrade') => {
                if (!CONFIG.SHEETS_API_URL) return;
                
                try {
                    await fetch(`${CONFIG.SHEETS_API_URL}?action=${action}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(trade)
                    });
                } catch (error) {
                    console.error('Sheets error:', error);
                }
            };

            const formatTime = () => {
                return new Date().toLocaleString('en-IN', {
                    timeZone: 'Asia/Kolkata',
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const calculateHoldingTime = (entryTs, exitTs) => {
                const diff = exitTs - entryTs;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                if (hours > 24) {
                    const days = Math.floor(hours / 24);
                    return `${days}d ${hours % 24}h`;
                } else if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else {
                    return `${minutes}m`;
                }
            };

            const stats = React.useMemo(() => {
                const openTrades = trades.filter(t => t.status === 'OPEN');
                const closedTrades = trades.filter(t => t.status === 'CLOSED');
                const today = new Date().toDateString();
                const todayTrades = trades.filter(t => new Date(t.entryTime).toDateString() === today);
                const todayPnl = todayTrades.filter(t => t.status === 'CLOSED').reduce((sum, t) => sum + (t.pnl || 0), 0);
                
                const winRate = closedTrades.length > 0 
                    ? ((closedTrades.filter(t => t.pnl > 0).length / closedTrades.length) * 100).toFixed(1)
                    : '0';
                
                const avgR = closedTrades.length > 0
                    ? (closedTrades.reduce((sum, t) => sum + (t.rMultiple || 0), 0) / closedTrades.length).toFixed(2)
                    : '0.00';
                
                const grossWin = closedTrades.filter(t => t.pnl > 0).reduce((sum, t) => sum + t.pnl, 0);
                const grossLoss = Math.abs(closedTrades.filter(t => t.pnl < 0).reduce((sum, t) => sum + t.pnl, 0));
                const profitFactor = grossLoss > 0 ? (grossWin / grossLoss).toFixed(2) : closedTrades.length > 0 ? 'âˆ' : '0';
                
                const bestR = closedTrades.length > 0 
                    ? Math.max(...closedTrades.map(t => t.rMultiple || 0)).toFixed(2)
                    : '0.00';

                return { 
                    openTrades, 
                    closedTrades, 
                    todayPnl, 
                    winRate, 
                    avgR,
                    profitFactor,
                    bestR,
                    totalClosed: closedTrades.length
                };
            }, [trades]);

            return (
                <div className="min-h-screen p-4">
                    <div className="max-w-2xl mx-auto">
                        {/* Header */}
                        <Header stats={stats} />

                        {/* Tabs */}
                        <Tabs activeTab={activeTab} setActiveTab={setActiveTab} />

                        {/* Content */}
                        {activeTab === 'entry' && (
                            <EntryForm 
                                trades={trades}
                                saveTrades={saveTrades}
                                sendTelegram={sendTelegram}
                                saveToSheets={saveToSheets}
                                formatTime={formatTime}
                            />
                        )}

                        {activeTab === 'exit' && (
                            <ExitTab
                                trades={trades}
                                saveTrades={saveTrades}
                                sendTelegram={sendTelegram}
                                saveToSheets={saveToSheets}
                                formatTime={formatTime}
                                calculateHoldingTime={calculateHoldingTime}
                                selectedTrade={selectedTrade}
                                setSelectedTrade={setSelectedTrade}
                            />
                        )}

                        {activeTab === 'analytics' && (
                            <Analytics trades={trades} />
                        )}

                        {activeTab === 'summary' && (
                            <Summary 
                                trades={trades}
                                sendTelegram={sendTelegram}
                            />
                        )}
                    </div>
                </div>
            );
        }

        // Header Component
        function Header({ stats }) {
            return (
                <div className="bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl p-6 mb-4">
                    <h1 className="text-3xl font-bold text-white mb-4">ğŸ“Š Professional Trading Journal</h1>
                    
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                        <MetricCard label="Open" value={stats.openTrades.length} color="text-yellow-300" />
                        <MetricCard label="Today P&L" value={`â‚¹${stats.todayPnl.toFixed(0)}`} color={stats.todayPnl >= 0 ? 'text-green-300' : 'text-red-300'} />
                        <MetricCard label="Win Rate" value={`${stats.winRate}%`} color="text-blue-300" />
                        <MetricCard label="Avg R" value={`${stats.avgR}R`} color="text-purple-300" />
                    </div>
                    
                    <div className="grid grid-cols-3 gap-3">
                        <MetricCard label="Profit Factor" value={stats.profitFactor} color="text-white" />
                        <MetricCard label="Total Trades" value={stats.totalClosed} color="text-white" />
                        <MetricCard label="Best R" value={`${stats.bestR}R`} color="text-green-300" />
                    </div>
                </div>
            );
        }

        function MetricCard({ label, value, color }) {
            return (
                <div className="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-white/20">
                    <div className="text-white/60 text-xs">{label}</div>
                    <div className={`${color} text-2xl font-bold`}>{value}</div>
                </div>
            );
        }

        // Tabs Component
        function Tabs({ activeTab, setActiveTab }) {
            const tabs = ['entry', 'exit', 'analytics', 'summary'];
            const labels = { entry: 'Entry', exit: 'Exit', analytics: 'Analytics', summary: 'Summary' };

            return (
                <div className="flex gap-2 mb-4 overflow-x-auto">
                    {tabs.map(tab => (
                        <button
                            key={tab}
                            onClick={() => setActiveTab(tab)}
                            className={`flex-shrink-0 px-4 py-3 rounded-xl font-semibold transition-all ${
                                activeTab === tab
                                    ? 'bg-blue-500 text-white shadow-lg'
                                    : 'bg-white/10 text-white/70 hover:bg-white/20'
                            }`}
                        >
                            {labels[tab]}
                        </button>
                    ))}
                </div>
            );
        }

        // Entry Form Component
        function EntryForm({ trades, saveTrades, sendTelegram, saveToSheets, formatTime }) {
            const [formData, setFormData] = useState({
                symbol: '', type: 'BUY', timeframe: 'Intraday', entry: '', quantity: '',
                target: '', stoploss: '', strategy: '', setupQuality: 5, marketCondition: '',
                emotionBefore: '', followingPlan: 'Yes', notes: ''
            });
            const [loading, setLoading] = useState(false);
            const [riskData, setRiskData] = useState(null);

            useEffect(() => {
                if (formData.entry && formData.stoploss && formData.target && formData.quantity) {
                    const entry = parseFloat(formData.entry);
                    const stoploss = parseFloat(formData.stoploss);
                    const target = parseFloat(formData.target);
                    const quantity = parseInt(formData.quantity);

                    const riskPer = Math.abs(entry - stoploss);
                    const rewardPer = Math.abs(target - entry);
                    const totalRisk = riskPer * quantity;
                    const rrRatio = (rewardPer / riskPer).toFixed(2);

                    setRiskData({ riskPer, rewardPer, totalRisk, rrRatio });
                } else {
                    setRiskData(null);
                }
            }, [formData.entry, formData.stoploss, formData.target, formData.quantity]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!formData.symbol || !formData.entry || !formData.quantity || !formData.target || !formData.stoploss) {
                    alert('Please fill all required fields!');
                    return;
                }

                setLoading(true);

                const trade = {
                    id: Date.now(),
                    ...formData,
                    entry: parseFloat(formData.entry),
                    quantity: parseInt(formData.quantity),
                    target: parseFloat(formData.target),
                    stoploss: parseFloat(formData.stoploss),
                    entryTime: formatTime(),
                    entryTimestamp: Date.now(),
                    status: 'OPEN',
                    pnl: 0,
                    rMultiple: 0,
                    totalRisk: riskData?.totalRisk || 0,
                    rrRatio: riskData?.rrRatio || 0
                };

                // Save to sheets
                await saveToSheets(trade);

                // Send telegram
                const message = `ğŸŸ¢ <b>TRADE ENTRY</b>

ğŸ“Š Symbol: <b>${trade.symbol}</b>
${trade.type === 'BUY' ? 'ğŸ“ˆ' : 'ğŸ“‰'} Type: <b>${trade.type}</b> | â±ï¸ ${trade.timeframe}
ğŸ’° Entry: â‚¹${trade.entry}
ğŸ“¦ Quantity: ${trade.quantity}
ğŸ¯ Target: â‚¹${trade.target}
ğŸ›‘ Stop Loss: â‚¹${trade.stoploss}

ğŸ“Š <b>ANALYSIS</b>
Risk: â‚¹${trade.totalRisk.toFixed(2)} | R:R: 1:${trade.rrRatio}
Strategy: ${trade.strategy || 'Not specified'}
Setup Quality: ${trade.setupQuality}/10 â­
Market: ${trade.marketCondition || 'Not specified'}

ğŸ˜Š <b>PSYCHOLOGY</b>
Emotion: ${trade.emotionBefore || 'Not specified'}
Following Plan: ${trade.followingPlan}

â° Time: ${trade.entryTime}
${trade.notes ? `ğŸ“ Notes: ${trade.notes}` : ''}`;

                await sendTelegram(message);

                // Save locally
                saveTrades([...trades, trade]);

                // Reset form
                setFormData({
                    symbol: '', type: 'BUY', timeframe: 'Intraday', entry: '', quantity: '',
                    target: '', stoploss: '', strategy: '', setupQuality: 5, marketCondition: '',
                    emotionBefore: '', followingPlan: 'Yes', notes: ''
                });
                setRiskData(null);
                setLoading(false);
                alert('âœ… Trade logged successfully!');
            };

            return (
                <form onSubmit={handleSubmit} className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 space-y-4">
                    <h2 className="text-xl font-bold text-white mb-4">ğŸŸ¢ New Trade Entry</h2>

                    <input
                        type="text"
                        placeholder="Symbol (e.g., RELIANCE)"
                        value={formData.symbol}
                        onChange={(e) => setFormData({ ...formData, symbol: e.target.value.toUpperCase() })}
                        className="w-full p-3 rounded-lg bg-white/20 text-white placeholder-white/50 border border-white/20 focus:border-blue-400 focus:outline-none"
                    />

                    <div className="grid grid-cols-2 gap-4">
                        <select
                            value={formData.type}
                            onChange={(e) => setFormData({ ...formData, type: e.target.value })}
                            className="p-3 rounded-lg bg-white/20 text-white border border-white/20"
                        >
                            <option value="BUY">BUY</option>
                            <option value="SELL">SELL</option>
                        </select>
                        <select
                            value={formData.timeframe}
                            onChange={(e) => setFormData({ ...formData, timeframe: e.target.value })}
                            className="p-3 rounded-lg bg-white/20 text-white border border-white/20"
                        >
                            <option value="Intraday">Intraday</option>
                            <option value="Swing">Swing (2-7 days)</option>
                            <option value="Positional">Positional (7+ days)</option>
                        </select>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <input
                            type="number"
                            step="0.01"
                            placeholder="Entry Price"
                            value={formData.entry}
                            onChange={(e) => setFormData({ ...formData, entry: e.target.value })}
                            className="p-3 rounded-lg bg-white/20 text-white placeholder-white/50 border border-white/20"
                        />
                        <input
                            type="number"
                            placeholder="Quantity"
                            value={formData.quantity}
                            onChange={(e) => setFormData({ ...formData, quantity: e.target.value })}
                            className="p-3 rounded-lg bg-white/20 text-white placeholder-white/50 border border-white/20"
                        />
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <input
                            type="number"
                            step="0.01"
                            placeholder="Target"
                            value={formData.target}
                            onChange={(e) => setFormData({ ...formData, target: e.target.value })}
                            className="p-3 rounded-lg bg-white/20 text-white placeholder-white/50 border border-white/20"
                        />
                        <input
                            type="number"
                            step="0.01"
                            placeholder="Stop Loss"
                            value={formData.stoploss}
                            onChange={(e) => setFormData({ ...formData, stoploss: e.target.value })}
                            className="p-3 rounded-lg bg-white/20 text-white placeholder-white/50 border border-white/20"
                        />
                    </div>

                    <select
                        value={formData.strategy}
                        onChange={(e) => setFormData({ ...formData, strategy: e.target.value })}
                        className="w-full p-3 rounded-lg bg-white/20 text-white border border-white/20"
                    >
                        <option value="">Select Strategy</option>
                        <option value="ORB">ORB (Opening Range Breakout)</option>
                        <option value="Breakout">Breakout & Retest</option>
                        <option value="EMA Crossover">EMA Crossover</option>
                        <option value="VWAP Bounce">VWAP Bounce</option>
                        <option value="Support/Resistance">Support/Resistance</option>
                    </select>

                    <div>
                        <label className="text-white/70 text-sm">Setup Quality: {formData.setupQuality}/10</label>
                        <input
                            type="range"
                            min="1"
                            max="10"
                            value={formData.setupQuality}
                            onChange={(e) => setFormData({ ...formData, setupQuality: e.target.value })}
                            className="w-full"
                        />
                    </div>

                    <select
                        value={formData.emotionBefore}
                        onChange={(e) => setFormData({ ...formData, emotionBefore: e.target.value })}
                        className="w-full p-3 rounded-lg bg-white/20 text-white border border-white/20"
                    >
                        <option value="">Emotion Before Trade</option>
                        <option value="Confident">ğŸ˜ Confident</option>
                        <option value="Calm">ğŸ˜Œ Calm</option>
                        <option value="Anxious">ğŸ˜° Anxious</option>
                        <option value="Fearful">ğŸ˜¨ Fearful</option>
                        <option value="Greedy">ğŸ¤‘ Greedy (FOMO)</option>
                    </select>

                    <textarea
                        placeholder="Notes (optional)"
                        value={formData.notes}
                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                        rows="2"
                        className="w-full p-3 rounded-lg bg-white/20 text-white placeholder-white/50 border border-white/20"
                    />

                    {riskData && (
                        <div className={`rounded-lg p-4 border ${riskData.rrRatio < 1.5 ? 'bg-red-500/20 border-red-500/50' : 'bg-yellow-500/20 border-yellow-500/50'}`}>
                            <div className="text-yellow-200 font-semibold mb-2">ğŸ“Š Trade Analysis</div>
                            <div className="grid grid-cols-2 gap-2 text-sm text-yellow-100">
                                <div>Risk: <span className="font-bold">â‚¹{riskData.totalRisk.toFixed(2)}</span></div>
                                <div>R:R: <span className="font-bold">1:{riskData.rrRatio}</span></div>
                            </div>
                        </div>
                    )}

                    <button
                        type="submit"
                        disabled={loading}
                        className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-colors disabled:opacity-50"
                    >
                        {loading ? 'â³ Sending...' : 'âœ… Log Trade Entry'}
                    </button>
                </form>
            );
        }

        // Exit Tab Component (simplified)
        function ExitTab({ trades, saveTrades, sendTelegram, saveToSheets, formatTime, calculateHoldingTime, selectedTrade, setSelectedTrade }) {
            const openTrades = trades.filter(t => t.status === 'OPEN');

            if (selectedTrade) {
                return <ExitForm
                    selectedTrade={selectedTrade}
                    setSelectedTrade={setSelectedTrade}
                    trades={trades}
                    saveTrades={saveTrades}
                    sendTelegram={sendTelegram}
                    saveToSheets={saveToSheets}
                    formatTime={formatTime}
                    calculateHoldingTime={calculateHoldingTime}
                />;
            }

            return (
                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6">
                    <h2 className="text-xl font-bold text-white mb-4">ğŸ”´ Open Positions</h2>
                    {openTrades.length === 0 ? (
                        <p className="text-white/60 text-center py-8">No open trades</p>
                    ) : (
                        <div className="space-y-3">
                            {openTrades.map(trade => (
                                <TradeCard key={trade.id} trade={trade} onExit={() => setSelectedTrade(trade)} />
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function TradeCard({ trade, onExit }) {
            return (
                <div className="bg-white/10 rounded-lg p-4 border border-white/20">
                    <div className="flex justify-between items-start mb-2">
                        <div>
                            <div className="text-white font-bold text-lg">{trade.symbol}</div>
                            <div className="text-white/60 text-sm">{trade.type} â€¢ {trade.strategy}</div>
                        </div>
                        <div className={`px-2 py-1 rounded text-xs font-bold ${trade.type === 'BUY' ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'}`}>
                            {trade.type}
                        </div>
                    </div>
                    <div className="grid grid-cols-3 gap-2 text-sm mb-3">
                        <div><div className="text-white/60">Entry</div><div className="text-white font-semibold">â‚¹{trade.entry}</div></div>
                        <div><div className="text-white/60">Target</div><div className="text-green-300 font-semibold">â‚¹{trade.target}</div></div>
                        <div><div className="text-white/60">SL</div><div className="text-red-300 font-semibold">â‚¹{trade.stoploss}</div></div>
                    </div>
                    <button
                        onClick={onExit}
                        className="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg"
                    >
                        Exit Trade
                    </button>
                </div>
            );
        }

        function ExitForm({ selectedTrade, setSelectedTrade, trades, saveTrades, sendTelegram, saveToSheets, formatTime, calculateHoldingTime }) {
            const [exitData, setExitData] = useState({ exitPrice: '', exitReason: '', emotionAfter: '', lessons: '' });
            const [loading, setLoading] = useState(false);

            const handleExit = async (e) => {
                e.preventDefault();
                
                if (!exitData.exitPrice) {
                    alert('Please enter exit price!');
                    return;
                }

                setLoading(true);

                const exitPrice = parseFloat(exitData.exitPrice);
                const pnl = selectedTrade.type === 'BUY'
                    ? (exitPrice - parseFloat(selectedTrade.entry)) * parseFloat(selectedTrade.quantity)
                    : (parseFloat(selectedTrade.entry) - exitPrice) * parseFloat(selectedTrade.quantity);

                const riskPer = Math.abs(selectedTrade.entry - selectedTrade.stoploss);
                const rMultiple = selectedTrade.type === 'BUY'
                    ? (exitPrice - selectedTrade.entry) / riskPer
                    : (selectedTrade.entry - exitPrice) / riskPer;

                const holdingTime = calculateHoldingTime(selectedTrade.entryTimestamp, Date.now());

                const updatedTrade = {
                    ...selectedTrade,
                    status: 'CLOSED',
                    exitPrice,
                    exitTime: formatTime(),
                    exitTimestamp: Date.now(),
                    pnl,
                    rMultiple,
                    holdingTime,
                    ...exitData
                };

                // Save to sheets
                await saveToSheets(updatedTrade, 'updateTrade');

                // Send telegram
                const message = `${pnl >= 0 ? 'ğŸŸ¢' : 'ğŸ”´'} <b>TRADE EXIT</b>

ğŸ“Š Symbol: <b>${updatedTrade.symbol}</b>
${updatedTrade.type === 'BUY' ? 'ğŸ“ˆ' : 'ğŸ“‰'} Type: <b>${updatedTrade.type}</b>
ğŸ’° Entry: â‚¹${updatedTrade.entry}
ğŸšª Exit: â‚¹${exitPrice}
ğŸ“¦ Quantity: ${updatedTrade.quantity}

ğŸ’¸ P&L: <b>â‚¹${pnl.toFixed(2)}</b>
ğŸ“Š R-Multiple: <b>${rMultiple.toFixed(2)}R</b>
â±ï¸ Holding: ${holdingTime}

Exit Reason: ${exitData.exitReason}
${exitData.lessons ? `ğŸ’¡ Lesson: ${exitData.lessons}` : ''}`;

                await sendTelegram(message);

                // Update locally
                const updatedTrades = trades.map(t => t.id === selectedTrade.id ? updatedTrade : t);
                saveTrades(updatedTrades);

                setLoading(false);
                setSelectedTrade(null);
                alert('âœ… Trade exit logged!');
            };

            return (
                <form onSubmit={handleExit} className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 space-y-4">
                    <h2 className="text-xl font-bold text-white mb-4">Exit Trade: {selectedTrade.symbol}</h2>

                    <input
                        type="number"
                        step="0.01"
                        placeholder="Exit Price"
                        value={exitData.exitPrice}
                        onChange={(e) => setExitData({ ...exitData, exitPrice: e.target.value })}
                        className="w-full p-3 rounded-lg bg-white/20 text-white placeholder-white/50 border border-white/20"
                    />

                    <select
                        value={exitData.exitReason}
                        onChange={(e) => setExitData({ ...exitData, exitReason: e.target.value })}
                        className="w-full p-3 rounded-lg bg-white/20 text-white border border-white/20"
                    >
                        <option value="">Exit Reason</option>
                        <option value="Target Hit">ğŸ¯ Target Hit</option>
                        <option value="Stop Loss">ğŸ›‘ Stop Loss</option>
                        <option value="Time Exit">â° Time Exit</option>
                        <option value="Manual">âœ‹ Manual Exit</option>
                    </select>

                    <textarea
                        placeholder="Lessons learned..."
                        value={exitData.lessons}
                        onChange={(e) => setExitData({ ...exitData, lessons: e.target.value })}
                        rows="2"
                        className="w-full p-3 rounded-lg bg-white/20 text-white placeholder-white/50 border border-white/20"
                    />

                    <div className="flex gap-2">
                        <button
                            type="button"
                            onClick={() => setSelectedTrade(null)}
                            className="flex-1 bg-white/20 hover:bg-white/30 text-white font-semibold py-3 rounded-lg"
                        >
                            Cancel
                        </button>
                        <button
                            type="submit"
                            disabled={loading}
                            className="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg disabled:opacity-50"
                        >
                            {loading ? 'â³ Sending...' : 'âœ… Log Exit'}
                        </button>
                    </div>
                </form>
            );
        }

        // Analytics Component
        function Analytics({ trades }) {
            const closedTrades = trades.filter(t => t.status === 'CLOSED');

            if (closedTrades.length === 0) {
                return (
                    <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6">
                        <h2 className="text-xl font-bold text-white mb-4">ğŸ“ˆ Advanced Analytics</h2>
                        <p className="text-white/60 text-center py-8">No closed trades yet. Complete at least one trade to see analytics!</p>
                    </div>
                );
            }

            // Calculate metrics
            const totalPnl = closedTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
            const winners = closedTrades.filter(t => t.pnl > 0);
            const losers = closedTrades.filter(t => t.pnl < 0);
            
            const avgWin = winners.length > 0 ? winners.reduce((sum, t) => sum + t.pnl, 0) / winners.length : 0;
            const avgLoss = losers.length > 0 ? Math.abs(losers.reduce((sum, t) => sum + t.pnl, 0) / losers.length) : 0;
            const expectancy = (totalPnl / closedTrades.length).toFixed(2);
            
            const grossWin = winners.reduce((sum, t) => sum + t.pnl, 0);
            const grossLoss = Math.abs(losers.reduce((sum, t) => sum + t.pnl, 0));
            const profitFactor = grossLoss > 0 ? (grossWin / grossLoss).toFixed(2) : 'âˆ';

            // Strategy breakdown
            const strategies = {};
            closedTrades.forEach(t => {
                const strat = t.strategy || 'Not specified';
                if (!strategies[strat]) strategies[strat] = { count: 0, wins: 0, pnl: 0 };
                strategies[strat].count++;
                if (t.pnl > 0) strategies[strat].wins++;
                strategies[strat].pnl += t.pnl;
            });

            // Emotion breakdown
            const emotions = {};
            closedTrades.forEach(t => {
                const emotion = t.emotionBefore || 'Not specified';
                if (!emotions[emotion]) emotions[emotion] = { count: 0, wins: 0 };
                emotions[emotion].count++;
                if (t.pnl > 0) emotions[emotion].wins++;
            });

            // Recent trades
            const recentTrades = [...closedTrades].reverse().slice(0, 5);

            return (
                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 space-y-4">
                    <h2 className="text-xl font-bold text-white mb-4">ğŸ“ˆ Advanced Analytics</h2>
                    
                    {/* Key Metrics */}
                    <div className="grid grid-cols-2 gap-4">
                        <MetricCard label="Expectancy" value={`â‚¹${expectancy}`} color="text-white" />
                        <MetricCard label="Profit Factor" value={profitFactor} color="text-white" />
                        <MetricCard label="Avg Win" value={`â‚¹${avgWin.toFixed(0)}`} color="text-green-300" />
                        <MetricCard label="Avg Loss" value={`â‚¹${avgLoss.toFixed(0)}`} color="text-red-300" />
                    </div>

                    {/* Strategy Breakdown */}
                    <div className="bg-white/5 rounded-lg p-4">
                        <h3 className="text-white font-semibold mb-3">Performance by Strategy</h3>
                        <div className="space-y-2">
                            {Object.entries(strategies).map(([name, data]) => {
                                const winRate = ((data.wins / data.count) * 100).toFixed(0);
                                return (
                                    <div key={name} className="flex justify-between text-sm">
                                        <span className="text-white">{name}</span>
                                        <span className="text-white/70">
                                            {data.count} trades â€¢ {winRate}% WR â€¢ {data.pnl >= 0 ? '+' : ''}â‚¹{data.pnl.toFixed(0)}
                                        </span>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Emotion Breakdown */}
                    <div className="bg-white/5 rounded-lg p-4">
                        <h3 className="text-white font-semibold mb-3">Performance by Emotion</h3>
                        <div className="space-y-2">
                            {Object.entries(emotions).map(([emotion, data]) => {
                                const winRate = ((data.wins / data.count) * 100).toFixed(0);
                                return (
                                    <div key={emotion} className="flex justify-between text-sm">
                                        <span className="text-white">{emotion}</span>
                                        <span className="text-white/70">
                                            {data.count} trades â€¢ {winRate}% WR
                                        </span>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Recent Trades */}
                    <div className="bg-white/5 rounded-lg p-4">
                        <h3 className="text-white font-semibold mb-3">Recent Trades</h3>
                        <div className="space-y-2">
                            {recentTrades.map(trade => (
                                <div key={trade.id} className="flex justify-between items-center text-sm p-2 bg-white/5 rounded">
                                    <span className="text-white font-semibold">{trade.symbol}</span>
                                    <span className="text-white/70">{trade.strategy}</span>
                                    <span className={`font-bold ${trade.pnl >= 0 ? 'text-green-300' : 'text-red-300'}`}>
                                        {trade.pnl >= 0 ? '+' : ''}â‚¹{trade.pnl.toFixed(0)}
                                    </span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Summary Component
        function Summary({ trades, sendTelegram }) {
            const today = new Date().toDateString();
            const todayTrades = trades.filter(t => new Date(t.entryTime).toDateString() === today);
            const todayPnl = todayTrades.filter(t => t.status === 'CLOSED').reduce((sum, t) => sum + (t.pnl || 0), 0);

            const sendDailySummary = async () => {
                const closedTrades = todayTrades.filter(t => t.status === 'CLOSED');
                const openTrades = todayTrades.filter(t => t.status === 'OPEN');
                const totalPnl = closedTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
                const winners = closedTrades.filter(t => t.pnl > 0).length;
                const losers = closedTrades.filter(t => t.pnl < 0).length;

                const message = `ğŸ“Š <b>DAILY SUMMARY</b>
ğŸ“… ${new Date().toLocaleDateString('en-IN')}

ğŸ“ˆ Total Trades: ${todayTrades.length}
âœ… Closed: ${closedTrades.length}
â³ Open: ${openTrades.length}

${closedTrades.length > 0 ? `ğŸ¯ Winners: ${winners}
âŒ Losers: ${losers}
ğŸ“Š Win Rate: ${((winners / closedTrades.length) * 100).toFixed(1)}%

ğŸ’° <b>Net P&L: ${totalPnl >= 0 ? '+' : ''}â‚¹${totalPnl.toFixed(2)}</b>` : 'No closed trades today.'}`;

                await sendTelegram(message);
                alert('âœ… Daily summary sent!');
            };

            const sendMonthlySummary = async () => {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                const monthTrades = trades.filter(t => {
                    const tradeDate = new Date(t.entryTime);
                    return tradeDate.getMonth() === currentMonth && tradeDate.getFullYear() === currentYear;
                });
                
                const closedTrades = monthTrades.filter(t => t.status === 'CLOSED');
                const openTrades = monthTrades.filter(t => t.status === 'OPEN');
                
                const totalPnl = closedTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
                const winners = closedTrades.filter(t => t.pnl > 0).length;
                const losers = closedTrades.filter(t => t.pnl < 0).length;
                
                const sortedTrades = [...closedTrades].sort((a, b) => b.pnl - a.pnl);
                const bestTrade = sortedTrades[0];
                const worstTrade = sortedTrades[sortedTrades.length - 1];
                
                const avgPnl = closedTrades.length > 0 ? totalPnl / closedTrades.length : 0;
                const avgR = closedTrades.length > 0 
                    ? (closedTrades.reduce((sum, t) => sum + (t.rMultiple || 0), 0) / closedTrades.length).toFixed(2)
                    : 0;
                
                const grossWin = closedTrades.filter(t => t.pnl > 0).reduce((sum, t) => sum + t.pnl, 0);
                const grossLoss = Math.abs(closedTrades.filter(t => t.pnl < 0).reduce((sum, t) => sum + t.pnl, 0));
                const profitFactor = grossLoss > 0 ? (grossWin / grossLoss).toFixed(2) : 'âˆ';
                
                // Strategy breakdown
                const strategies = {};
                closedTrades.forEach(t => {
                    const strat = t.strategy || 'Not specified';
                    if (!strategies[strat]) strategies[strat] = { count: 0, wins: 0, pnl: 0 };
                    strategies[strat].count++;
                    if (t.pnl > 0) strategies[strat].wins++;
                    strategies[strat].pnl += t.pnl;
                });
                
                const mostTraded = Object.entries(strategies).sort((a, b) => b[1].count - a[1].count)[0];
                
                const monthName = now.toLocaleDateString('en-IN', { month: 'long', year: 'numeric' });

                let strategyText = '';
                Object.entries(strategies).forEach(([name, data]) => {
                    const winRate = ((data.wins / data.count) * 100).toFixed(0);
                    strategyText += `${name}: ${data.count} trades, ${winRate}% WR, ${data.pnl >= 0 ? '+' : ''}â‚¹${data.pnl.toFixed(0)}\n`;
                });

                const message = `ğŸ“… <b>MONTHLY SUMMARY - ${monthName}</b>

ğŸ“Š <b>OVERVIEW</b>
ğŸ“ˆ Total Trades: ${monthTrades.length}
âœ… Closed: ${closedTrades.length}
â³ Open: ${openTrades.length}

${closedTrades.length > 0 ? `ğŸ¯ <b>PERFORMANCE</b>
Winners: ${winners} (${((winners / closedTrades.length) * 100).toFixed(1)}%)
Losers: ${losers} (${((losers / closedTrades.length) * 100).toFixed(1)}%)

ğŸ’° <b>P&L STATS</b>
Net P&L: ${totalPnl >= 0 ? '+' : ''}â‚¹${totalPnl.toFixed(2)}
Avg P&L: ${avgPnl >= 0 ? '+' : ''}â‚¹${avgPnl.toFixed(2)}
Avg R-Multiple: ${avgR}R
Profit Factor: ${profitFactor}

${bestTrade ? `ğŸ† Best: ${bestTrade.symbol} (+â‚¹${bestTrade.pnl.toFixed(2)}, ${bestTrade.rMultiple.toFixed(2)}R)\n` : ''}${worstTrade ? `ğŸ“‰ Worst: ${worstTrade.symbol} (â‚¹${worstTrade.pnl.toFixed(2)}, ${worstTrade.rMultiple.toFixed(2)}R)\n` : ''}
${strategyText ? `ğŸ“Š <b>BY STRATEGY</b>\n${strategyText}` : ''}` : 'No closed trades this month.'}
${openTrades.length > 0 ? `\n<b>Open: ${openTrades.length}</b>\n${openTrades.map(t => `â€¢ ${t.symbol} ${t.type} @ â‚¹${t.entry}`).join('\n')}` : ''}`;

                await sendTelegram(message);
                alert('âœ… Monthly summary sent!');
            };

            return (
                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 space-y-4">
                    <h2 className="text-xl font-bold text-white mb-4">ğŸ“Š Summary</h2>

                    <div className="grid grid-cols-2 gap-4">
                        <MetricCard label="Total Trades" value={todayTrades.length} color="text-white" />
                        <MetricCard label="Today P&L" value={`â‚¹${todayPnl.toFixed(2)}`} color={todayPnl >= 0 ? 'text-green-300' : 'text-red-300'} />
                    </div>

                    <button
                        onClick={sendDailySummary}
                        className="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 rounded-lg"
                    >
                        ğŸ“Š Send Daily Summary
                    </button>

                    <button
                        onClick={sendMonthlySummary}
                        className="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 rounded-lg"
                    >
                        ğŸ“… Send Monthly Summary
                    </button>

                    <div className="pt-4">
                        <h3 className="text-white font-semibold mb-3">Today's Trades</h3>
                        {todayTrades.length === 0 ? (
                            <p className="text-white/60 text-center py-8">No trades today</p>
                        ) : (
                            <div className="space-y-2">
                                {todayTrades.map(trade => (
                                    <div key={trade.id} className="bg-white/10 rounded-lg p-3 border border-white/20">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <div className="text-white font-semibold">{trade.symbol}</div>
                                                <div className="text-white/60 text-xs">{trade.type} â€¢ {trade.strategy}</div>
                                            </div>
                                            <div className="text-right">
                                                <div className={`text-xs font-semibold px-2 py-1 rounded ${trade.status === 'OPEN' ? 'bg-yellow-500/20 text-yellow-300' : 'bg-gray-500/20 text-gray-300'}`}>
                                                    {trade.status}
                                                </div>
                                                {trade.status === 'CLOSED' && (
                                                    <div className={`text-sm font-bold mt-1 ${trade.pnl >= 0 ? 'text-green-300' : 'text-red-300'}`}>
                                                        {trade.pnl >= 0 ? '+' : ''}â‚¹{trade.pnl.toFixed(2)}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<TradingJournal />, document.getElementById('root'));
    </script>
</body>
</html>